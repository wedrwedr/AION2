<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>아이온2 종족 이해도 계산기</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "맑은 고딕", "Segoe UI", sans-serif;
      max-width: 520px;
      margin: 30px auto;
      padding: 0 15px;
      background: #f8f9fa;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 0.8em;
    }
    .container {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    }
    label {
      display: block;
      margin: 1.1em 0 0.4em;
      font-weight: 600;
      color: #444;
    }
    select, input[type="number"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1.05rem;
      box-sizing: border-box;
    }
    #result {
      margin-top: 2em;
      padding: 20px;
      background: #f1f8ff;
      border-radius: 10px;
      border-left: 5px solid #3498db;
      line-height: 1.6;
    }
    .highlight {
      font-weight: bold;
      color: #e74c3c;
    }
    .small {
      color: #777;
      font-size: 0.95rem;
    }
    .note {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      padding: 12px;
      border-radius: 6px;
      margin-top: 1em;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>종족 이해도 계산기</h1>
 
  <label for="currentLevel">현재 레벨</label>
  <select id="currentLevel">
    <option value="1" selected>1레벨</option>
    <option value="2">2레벨</option>
    <option value="3">3레벨</option>
    <option value="4">4레벨</option>
    <option value="5">5레벨</option>
    <option value="6">6레벨</option>
    <option value="7">7레벨</option>
    <option value="8">8레벨</option>
    <option value="9">9레벨</option>
  </select>
 
  <label for="lockCount">잠글 슬롯 개수</label>
  <select id="lockCount">
    <option value="0" selected>0개 (잠그지 않음)</option>
  </select>
 
  <label for="currentExp">현재 레벨에서 쌓인 경험치</label>
  <input type="number" id="currentExp" min="0" value="0" placeholder="0 ~ 다음레벨까지">
 
  <div id="result"></div>
</div>

<script>
const expTable = [0, 0, 1000, 4000, 10000, 20000, 40000, 80000, 160000, 300000, 500000];

const lockExtraCrystals = [0, 5, 10, 30, 75, 170, 265, 360, 455, 550];

function updateLockOptions() {
  const currentLevel = parseInt(document.getElementById("currentLevel").value);
  const lockSel = document.getElementById("lockCount");
  const currentLock = parseInt(lockSel.value) || 0;
  lockSel.innerHTML = '<option value="0" selected>0개 (잠그지 않음)</option>';
  for (let i = 1; i < currentLevel; i++) {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = i + "개";
    if (i === currentLock) opt.selected = true;
    lockSel.appendChild(opt);
  }
  calculate();
}

function updateMaxExp() {
  const currentLevel = parseInt(document.getElementById("currentLevel").value);
  const currentExpInput = document.getElementById("currentExp");
  if (currentLevel === 10) {
    currentExpInput.max = 0;
    currentExpInput.placeholder = "이미 10레벨 최대";
    currentExpInput.value = 0;
    currentExpInput.disabled = true;
  } else {
    const maxExp = expTable[currentLevel + 1] - expTable[currentLevel];
    currentExpInput.max = maxExp;
    currentExpInput.placeholder = `0 ~ ${maxExp.toLocaleString()}`;
    currentExpInput.disabled = false;
  }
  calculate();
}

function calculate() {
  const currentLevel = parseInt(document.getElementById("currentLevel").value);
  const lock = parseInt(document.getElementById("lockCount").value);
  let current = parseInt(document.getElementById("currentExp").value) || 0;

  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "";

  if (isNaN(currentLevel) || isNaN(lock) || isNaN(current)) {
    return;
  }

  if (currentLevel === 10) {
    resultDiv.innerHTML = '<strong style="color:#27ae60;">이미 10레벨을 달성했습니다!</strong>';
    return;
  }

  const nextLevelExp = expTable[currentLevel + 1] - expTable[currentLevel];
  if (current < 0 || current > nextLevelExp) {
    resultDiv.innerHTML = '<strong style="color:#e74c3c;">현재 경험치 범위를 벗어났습니다.</strong>';
    return;
  }

  if (lock >= currentLevel) {
    resultDiv.innerHTML = '<strong style="color:#e74c3c;">잠글 슬롯 개수는 현재 레벨 미만이어야 합니다.</strong>';
    return;
  }

  const neededExp = nextLevelExp - current;
  const openSlots = currentLevel - lock;
  const expPerRun = currentLevel * 100;

  const crystalsPerRun = (5 * currentLevel) + lockExtraCrystals[lock];

  const runs = Math.ceil(neededExp / expPerRun);
  const totalCrystals = runs * crystalsPerRun;

  let html = `<strong>현재 레벨 : ${currentLevel}레벨</strong><br>`;
  html += `다음 레벨까지 필요 경험치 : <span class="highlight">${neededExp.toLocaleString()}</span><br><br>`;
  html += `잠금 슬롯 : ${lock}개 (열린 슬롯 ${openSlots}개)<br>`;
  html += `한 판당 경험치 : <strong>${expPerRun.toLocaleString()}</strong><br>`;
  html += `한 판당 결정 : <strong>${crystalsPerRun.toLocaleString()}</strong><br>`;
  html += `필요 횟수 : <span class="highlight">${runs.toLocaleString()} 회</span><br>`;
  html += `필요 결정 수 : <span class="highlight">${totalCrystals.toLocaleString()} 개</span><br>`;
 
  if (neededExp <= 0) {
    html += `<br><span style="color:#27ae60; font-weight:bold;">이미 다음 레벨 달성했습니다!</span>`;
  }
 
  resultDiv.innerHTML = html;
}

document.getElementById("currentLevel").addEventListener("change", () => {
  updateLockOptions();
  updateMaxExp();
});
document.getElementById("lockCount").addEventListener("change", calculate);
document.getElementById("currentExp").addEventListener("input", calculate);

window.onload = function() {
  updateLockOptions();
  updateMaxExp();
  calculate();
};
</script>
</body>
</html>